!function(){window.ytdlr=(e=>main(e));let util={base:"https://www.youtube.com",sub:(e,t,a=0,r,i=0)=>e.substring(e.indexOf(t)+a,e.indexOf(r,e.indexOf(t)+a)+i),hmsToMs:e=>{let t=0;return(e=e.split(":").reverse())[0]&&(t+=1e3*e[0]),e[1]&&(t+=6e4*e[1]),e[2]&&(t+=36e5*e[2]),t},msToHms:e=>{let t=new Date(e).toISOString().substr(11,8).split(":"),a=Math.floor(e/1e3/60/60).toString();for(a>23&&(t[0]=a);t.length>2&&"00"===t[0]&&t[1].startsWith("0");)t.shift();return t.length>2&&"00"===t[0]&&t.shift(),t[0].startsWith("0")&&(t[0]=t[0].substr(1)),t.join(":")},formatId:e=>{let t=e.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i);return t?t[1]:e},getThumb:e=>e.indexOf("hqdefault")>=0?`https://i3.ytimg.com/vi/${e.match(/vi\/(.*?)\//)[1]}/mqdefault.jpg`:e,formatStat:(e,t)=>Number(e.substr(0,e.indexOf(t)).trim().replace(/,/g,"")),decodeStr:(e="")=>e.replace(/\+/g," ")};function get(e,t={}){if(t.query){let a="";for(let e in t.query)a+=`&${e}=${encodeURIComponent(t.query[e])}`;-1===e.indexOf("?")&&(a="?"+a.substr(1)),e+=a}let a=fetch(e,{headers:t.headers});return a.text=(()=>Promise.resolve(a).then(e=>e.text())),a}async function main(e=window.location.href){let t=util.formatId(e),a=await getPlayerData(t);return formatResponse(await getVideoData(t,a.sts),a.fn)}function formatResponse(e,t){let a=e.player_response.videoDetails,r={error:util.decodeStr(e.player_response.playabilityStatus.reason),videoId:a.videoId,channelId:a.channelId,title:util.decodeStr(a.title),description:util.decodeStr(a.shortDescription),author:util.decodeStr(a.author),keywords:a.keywords?a.keywords.map(e=>util.decodeStr(e)):[],viewCount:a.viewCount,isPrivate:a.isPrivate,isLiveContent:a.isLiveContent,allowRatings:a.allowRatings,isOwnerViewing:a.isOwnerViewing,averageRating:a.averageRating,thumbnails:a.thumbnail.thumbnails,duration:1e3*a.lengthSeconds,formats:e.player_response.streamingData?e.player_response.streamingData.formats:[]};return r.error||delete r.error,r.formats=r.formats.map(e=>{e.s&&(e.url+=`&${e.sp}=`+t(e.s)),e.mimeType=util.decodeStr(e.mimeType);let a={itag:e.itag,format:e.mimeType.split(";")[0].split("/")[1],type:e.width&&e.audioQuality?"video/audio":e.width?"video":e.audioQuality?"audio":null,codecs:e.mimeType.match(/codecs="(.*?)"/)[1].split(",").map(e=>e.trim())};return e.contentLength&&(a.size=e.contentLength),e.approxDurationMs&&(a.duration=e.approxDurationMs),a.type.indexOf("video")>=0&&(e.qualityLabel&&(a.quality=e.qualityLabel),e.width&&e.height&&(a.dimension=`${e.width}x${e.height}`),e.bitrate&&(a.bitrate=e.bitrate.toString())),a.type.indexOf("audio")>=0&&e.audioSampleRate&&(a.samplerate=e.audioSampleRate),a.url=e.url,a}),r}async function getPlayerData(e){let t=await getPlayerUrl(e),a=await get(t).text();return{sts:util.sub(a,",sts:",5,","),fn:findCipherFunctions(a)}}async function getPlayerUrl(e,t=3){let a=await get("watch",{base:util.base,query:{v:e,hl:"en",bpctr:Math.ceil(Date.now()/1e3)}}).text(),r=util.base+util.sub(a,"/s/player/",0,"base.js",7);if(r.indexOf("/s/player/")<0){if(t<0)throw new Error("Could not retrieve player url!");r=await getPlayerUrl(e,--t)}return r}function findCipherFunctions(js){js=js.substr(js.indexOf('a=a.split("");var')+1);let top=util.sub(js,'a=a.split("")',-15,"};",1),side=util.sub(js,`var ${util.sub(top,'a=a.split("")',14,"(").split(".")[0]}`,0,"};",2);return eval(side+top)}async function getVideoData(e,t,a){"e"===t&&(t="");let r=await getVideoInfo(e,t,a);if("ok"!==(r=parseData(r)).status)throw new Error(util.decodeStr(r.reason));return a||r.player_response.streamingData||(r=await getVideoData(e,t,!0)),r}async function getVideoInfo(e,t,a){return await get("get_video_info",{base:util.base,query:{video_id:e,eurl:"https://youtube.googleapis.com/v/"+e,ps:"default",gl:"US",hl:"en",el:a?"detailpage":"embedded",sts:t}}).text()}function parseData(e){let t={};return e.split("&").forEach(e=>{let a=e.substr(0,e.indexOf("=")),r=e.substr(e.indexOf("=")+1);r=decodeURIComponent(r),"player_response"===a&&(r=JSON.parse(r)),r.constructor===String&&(r.indexOf("&")>=0&&"url"!==a&&"shortDescription"!==a?r=parseData(r):r.indexOf(",")>=0?r=r.split(","):"true"===r?r=!0:"false"===r?r=!1:isNaN(r)||(r=Number(r))),t[a]=r}),t&&t.player_response&&t.player_response.streamingData&&(t.player_response.streamingData&&t.player_response.streamingData.adaptiveFormats&&t.player_response.streamingData.formats.push(...t.player_response.streamingData.adaptiveFormats),t.player_response.streamingData.formats=t.player_response.streamingData.formats.map(e=>{if(e.cipher){let t=parseData(e.cipher);return delete e.cipher,{...e,...t}}return e})),t}}();